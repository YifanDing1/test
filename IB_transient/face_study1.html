<!DOCTYPE html>

<!--Line judgment task-->

<html>
  <head>
    <title>Line Judgments</title>
    <style>
    canvas {
      position: absolute;
      top: 0px;
      left: 0px;
      bottom: 0px;
      right: 0px;
      margin: 0 auto;
      cursor: none;
    }
    #crossDisplay {
      background-color: transparent;
      z-index: 0;
      margin: 0 auto;
    }
    #maskDisplay{
      background-color: transparent;
      z-index: 3;
      margin: 0 auto;
    }
    #fixDisplay {
      background-color: transparent;
      z-index: 1;
      margin: 0 auto;
    }
    #bgDisplay {
      background-color: transparent;
      z-index: 2;
      margin: 0 auto;
    }
    #trialScreen {
      font-family: 'Arial';
      font-size: 25px;
      display: none;
      margin: 0 auto;
      width: 800px;
      height:600px;
    }
    #endScreen {
      font-family: 'Arial';
      font-size: 20px;
      position:absolute;
      display: none;
      top: 200px;
      left: 0px;
      bottom: 0px;
      right: 0px;
      margin: 0 auto;
      width: 800px;
    }
    #instructionScreen {
      font-family: 'Arial';
      font-size: 25px;
      text-align: center;
      display: none;
      width: 800px;
      margin: 0 auto;
    }
    #fullAttentionInst {
      font-family: 'Arial';
      font-size: 25px;
      text-align: center;
      display: none;
      width: 900px;
      margin: 0 auto;
    }
    #debrief {
      font-family: 'Arial';
      font-size: 18px;
      text-align: center;
      display: none;
      width: 800px;
      margin: 0 auto;
    }
    #line_judgment, #face_notice, #face_question_yes,
    #face_question, #square_notice1, #face_question1,
    #face_question_yes1, #playback_pre, #playback {
      position: absolute;
      display: none;
      top: 200px;
      left: 0px;
      bottom: 0px;
      right: 0px;
      width: 800px;
      height: 400px;
      margin: 0 auto
    }
    #demographics {
      position: absolute;
      display: none;
      top: 50px;
      left: 0px;
      bottom: 0px;
      right: 0px;
      width: 800px;
      height: 550px;
      margin: 0 auto
    }
    #prior{
      position: absolute;
      display: none;
      top: 50px;
      left: 0px;
      bottom: 0px;
      right: 0px;
      width: 800px;
      height: 600px;
      margin: 0 auto
    }
    label > input {
      visibility: hidden; /* Makes input not-clickable */
      position: absolute;
    }
    label > input + img {
      cursor:pointer;
      border:3px solid transparent;
    }
    label > input:checked + img {
      border:3px solid #FF0000;
    }
    .nextButton {
      background-color: #C70039;
      font-size: 50px;
      width: 400px;
      padding: 15px;
      margin: 0 auto;
    }
    .nextButton:hover {
      background-color: #900C3F;
      cursor: pointer;
    }
    fieldset {
      border: 0px;
      font-family: "Arial", sans-serif;
      position: absolute;
      top: 0px;
      left: 0px;
      bottom: 0px;
      right:0px;
      width:500px;
      margin:0 auto;
    }
    form {
      position: absolute;
      top: 0px;
      left: 0px;
      bottom: 0px;
      right: 0px;
      width:800px;
      margin:0 auto;
    }
    </style>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  </head>
  <body style="font-family:'Arial'">
    <div id="line_judgment">
        <form id="line_judgment_task" name="line_judgment_task" align='center'><fieldset align='left' style="border:0 none;align-content: left">
        Which arm of the cross was longer?<br /><br />
        <input type="radio" name="line_judgment_ans" value="vert"/>The vertical ( | ) arm<br />
        <input type="radio" name="line_judgment_ans" value="horiz"/>The horizontal ( --- ) arm
        <br /><br /><br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('line_judgment', 'line_judgment_task')">Continue</button>
        <p id="line_judgment_task_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>
    <div id="face_notice">
        <form id="word_survey" name="word_survey" align='center'><fieldset align='left' style="border:0 none;">
        Did you notice an extra object on that trial?<br /><br />
        <input type="radio" name="face_notice" value="Yes"/>Yes<br />
        <input type="radio" name="face_notice" value="No"/>No
        <br /><br /><br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('face_notice', 'word_survey')">Continue</button>
        <p id="word_survey_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>
    <div id="face_question_yes">
        <form id="face_survey_yes" name="face_survey_yes" align='center'><fieldset align='left' style="border:0 none;">
        Describe what you saw: <br /><br />
        <input type="text" name="id_face_survey_yes" id="id_face_survey_yes" value="" style="width: 600px; height: 20px">
        <br /><br /><br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('face_question_yes', 'face_survey_yes')">Continue</button>
        <p id="face_survey_yes_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>
    <div id="face_question">
        <form id="face_survey" name="face_survey" align='center'><fieldset align='left' style="border:0 none;">
        What was the extra object? If you didn't see one or don't know, just guess. <br /><br class="faces_break_start" />
            <span face-type="happy">
               <input type="radio" name="face_question" value="happy" style="margin-left: 30px"/>
                <div class="face happy_face">
                <svg height="100" width="100">
                    <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
                    <svg height="100" width="100" x="30" y="25">
                        <ellipse cx="10" cy="10" rx="5" ry="10" />
                    </svg>
                    <svg height="100" width="100" x="50" y="25">
                      <ellipse cx="10" cy="10" rx="5" ry="10" />
                    </svg>
                    <svg height="70" width="100" x="10" y="55">
                        <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
                    </svg>
                </svg>
            </div>
            </span>
            <span face-type="unhappy">
               <input type="radio" name="face_question" value="sad" style="margin-left: 30px"/>
                <div class="face unhappy_face">
                <svg height="100" width="100">
                  <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
                  <svg height="100" width="100" x="30" y="25">
                  <ellipse cx="10" cy="10" rx="5" ry="10" />
                  </svg>
                  <svg height="100" width="100" x="50" y="25">
                  <ellipse cx="10" cy="10" rx="5" ry="10" />
                  </svg>
                  <svg height="70" width="100" y="4">
                    <ellipse cx="51" cy="75" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
                  </svg>
                </svg>
            </div>
            </span>
            <span face-type="circle">
               <input type="radio" name="face_question" value="circle" style="margin-left: 30px"/>
                <div class="face circle">
                <svg height="100" width="100">
                  <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
                </svg>
            </div>
            </span>

            <br class="faces_break_mid"/><br class="faces_break_mid"/><br class="faces_break_mid"/>

            <span face-type="neutral">
               <input type="radio" name="face_question" value="neutral" style="margin-left: 30px"/>
                <div class="face neutral_face">
            <svg height="100" width="100">
              <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
              <svg height="100" width="100" x="30" y="25">
              <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <svg height="100" width="100" x="50" y="25">
              <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <rect x="31" y="65" width="40" height="1" stroke-width="3" stroke="black"></rect>
            </svg>
          </div>
            </span>
            <span face-type="inverted">
               <input type="radio" name="face_question" value="inverted" style="margin-left: 30px"/>
                <div class="face upside_down_face" style="transform: rotate(180deg)">
            <svg height="100" width="100">
              <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
              <svg height="100" width="100" x="30" y="25">
              <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <svg height="100" width="100" x="50" y="25">
              <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <svg height="70" width="100" x="10" y="55">
                <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
              </svg>
            </svg>
          </div>
            </span>
            <span face-type="scrambled">
               <input type="radio" name="face_question" value="scrambled" style="margin-left: 30px"/>
                <div class="face a_scrambled_face">
            <svg height="100" width="100" style="transform: rotate(90deg)">
              <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
              <svg height="100" width="100" x="30" y="20">
                <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <svg height="100" width="100" x="55" y="60">
                <ellipse cx="10" cy="10" rx="10" ry="5" />
              </svg>
              <svg height="70" width="100" x="10" y="40">
                <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
              </svg>
            </svg>
          </div>
            </span>

        <br /> <br /> <br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('face_question', 'face_survey')">Continue</button>
        <p id="face_survey_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>

    <div id="square_notice1">
        <form id="square_survey" name="square_survey" align='center'><fieldset align='left' style="border:0 none;">
        Did you notice an extra object on that trial?<br /><br />
        <input type="radio" name="square_notice1" value="Yes"/>Yes<br />
        <input type="radio" name="square_notice1" value="No"/>No
        <br /><br /><br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('square_notice1', 'square_survey')">Continue</button>
        <p id="square_survey_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>
    <div id="face_question_yes1">
        <form id="face_survey_yes1" name="face_survey_yes1" align='center'><fieldset align='left' style="border:0 none;">
        Describe what you saw: <br /><br />
        <input type="text" name="id_face_survey_yes1" id="id_face_survey_yes1" value="" style="width: 600px; height: 20px">
        <br /><br /><br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('face_question_yes1', 'face_survey_yes1')">Continue</button>
        <p id="face_survey_yes1_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>
    <div id="face_question1">
        <form id="face_survey1" name="face_survey1" align='center'><fieldset align='left' style="border:0 none;">
        What was the extra object? If you didn't see one or don't know, just guess. <br /><br class="faces_break_start1" />
            <span face-type1="happy">
               <input type="radio" name="face_question1" value="happy" style="margin-left: 30px"/>
                <div class="face happy_face">
                <svg height="100" width="100">
                    <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
                    <svg height="100" width="100" x="30" y="25">
                        <ellipse cx="10" cy="10" rx="5" ry="10" />
                    </svg>
                    <svg height="100" width="100" x="50" y="25">
                      <ellipse cx="10" cy="10" rx="5" ry="10" />
                    </svg>
                    <svg height="70" width="100" x="10" y="55">
                        <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
                    </svg>
                </svg>
            </div>
            </span>
            <span face-type1="unhappy">
               <input type="radio" name="face_question1" value="sad" style="margin-left: 30px"/>
                <div class="face unhappy_face">
                <svg height="100" width="100">
                  <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
                  <svg height="100" width="100" x="30" y="25">
                  <ellipse cx="10" cy="10" rx="5" ry="10" />
                  </svg>
                  <svg height="100" width="100" x="50" y="25">
                  <ellipse cx="10" cy="10" rx="5" ry="10" />
                  </svg>
                  <svg height="70" width="100" y="4">
                    <ellipse cx="51" cy="75" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
                  </svg>
                </svg>
            </div>
            </span>
            <span face-type1="circle">
               <input type="radio" name="face_question1" value="circle" style="margin-left: 30px"/>
                <div class="face circle">
                <svg height="100" width="100">
                  <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
                </svg>
            </div>
            </span>

            <br class="faces_break_mid"/><br class="faces_break_mid"/><br class="faces_break_mid1"/>

            <span face-type1="neutral">
               <input type="radio" name="face_question1" value="neutral" style="margin-left: 30px"/>
                <div class="face neutral_face">
            <svg height="100" width="100">
              <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
              <svg height="100" width="100" x="30" y="25">
              <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <svg height="100" width="100" x="50" y="25">
              <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <rect x="31" y="65" width="40" height="1" stroke-width="3" stroke="black"></rect>
            </svg>
          </div>
            </span>
            <span face-type1="inverted">
               <input type="radio" name="face_question1" value="inverted" style="margin-left: 30px"/>
                <div class="face upside_down_face" style="transform: rotate(180deg)">
            <svg height="100" width="100">
              <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
              <svg height="100" width="100" x="30" y="25">
              <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <svg height="100" width="100" x="50" y="25">
              <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <svg height="70" width="100" x="10" y="55">
                <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
              </svg>
            </svg>
          </div>
            </span>
            <span face-type1="scrambled">
               <input type="radio" name="face_question1" value="scrambled" style="margin-left: 30px"/>
                <div class="face a_scrambled_face">
            <svg height="100" width="100" style="transform: rotate(90deg)">
              <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
              <svg height="100" width="100" x="30" y="20">
                <ellipse cx="10" cy="10" rx="5" ry="10" />
              </svg>
              <svg height="100" width="100" x="55" y="60">
                <ellipse cx="10" cy="10" rx="10" ry="5" />
              </svg>
              <svg height="70" width="100" x="10" y="40">
                <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
              </svg>
            </svg>
          </div>
            </span>

        <br /> <br /> <br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('face_question1', 'face_survey1')">Continue</button>
        <p id="face_survey1_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>
    <div id="playback_pre">
        <form id="playback_pre_survey" name="playback_pre_survey" align='center'><fieldset align='left' style="border:0 none;">
        Did the animation play smoothly, with no obvious lagging or freezing? <br /><br />
        <input type="radio" name="playback_pre" value="Yes"/>Yes<br />
        <input type="radio" name="playback_pre" value="No"/>No
        <br /><br /><br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('playback_pre', 'playback_pre_survey')">Continue</button>
        <p id="playback_pre_survey_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>
    <div id="playback">
        <form id="playback_survey" name="playback_survey" align='center'><fieldset align='left' style="border:0 none;">
        Please describe the playback issues you experienced: <br /><br />
        <input type="text" name="id_playback" id="id_playback" value="" style="width: 600px; height: 20px">
        <br /><br /><br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('playback', 'playback_survey')">Continue</button>
        <p id="playback_survey_error_msg" style="color:red; font-weight:bold; text-align: center"></p>
        </fieldset>
        </form>
    </div>
    <div id="demographics" style="display: none">
        <form id="demo_survey" name="demo_survey" align='center'><fieldset align='left'>
        This short survey asks you to provide some demographic
        information about yourself. None of the information will allow us
        to identify you and it will be analyzed by combining across
        responses from many people. <br /> Your responses will not affect your
        compensation. <br /><br /><br />
        What is your age?<br />
        <input type="radio" name="id_age" value="Under 18">Under 18<br />
        <input type="radio" name="id_age" value="18-24">18 - 24<br />
        <input type="radio" name="id_age" value="25-34">25 - 34<br />
        <input type="radio" name="id_age" value="35-44">35 - 44<br />
        <input type="radio" name="id_age" value="45-54">45 - 54<br />
        <input type="radio" name="id_age" value="55-64">55 - 64<br />
        <input type="radio" name="id_age" value="65+">Over 65
        <br /><br />
        Please provide your age and the country in which you currently live.
        <select id='country_options'>
        <option selected>United States</option>
        <option>China</option>
        <option>Japan</option>
        <option>Germany</option>
        <option>India</option>
        <option>Brazil</option>
        <option>United Kingdom</option>
        <option>Korea</option>
        <option>France</option>
        <option>Italy</option>
        <option>Russia</option>
        <option>Mexico</option>
        <option>Canada</option>
        <option>Spain</option>
        <option>Indonesia</option>
        <option>Vietnam</option>
        <option>Turkey</option>
        <option>Australia</option>
        <option>Taiwan</option>
        <option>Philippines</option>
        <option>Afghanistan</option>
        <option>Albania</option>
        <option>Algeria</option>
        <option>American Samoa</option>
        <option>Andorra</option>
        <option>Anguilla</option>
        <option>Antarctica</option>
        <option>Antigua And Barbuda</option>
        <option>Argentina</option>
        <option>Armenia</option>
        <option>Aruba</option>
        <option>Australia</option>
        <option>Austria</option>
        <option>Azerbaijan</option>
        <option>Bahamas</option>
        <option>Bahrain</option>
        <option>Bangladesh</option>
        <option>Barbados</option>
        <option>Belarus</option>
        <option>Belgium</option>
        <option>Belize</option>
        <option>Benin</option><option>Bermuda</option><option>Bhutan</option><option>Bolivia</option><option>Bosnia and Herzegovina</option><option>Botswana</option><option>Bouvet Island</option><option>Brazil</option><option>British Indian Ocean Territory</option><option>Brunei Darussalam</option><option>Bulgaria</option><option>Burkina Faso</option><option>Burundi</option><option>Cambodia</option><option>Cameroon</option><option>Canada</option><option>Cape Verde</option><option>Cayman Islands</option><option>Central African Republic</option><option>Chad</option><option>Chile</option><option>China</option><option>Christmas Island</option><option>Cocos (Keeling) Islands</option><option>Colombia</option><option>Comoros</option><option>Congo</option><option>Congo, the Democratic Republic of the</option><option>Cook Islands</option><option>Costa Rica</option><option>Cote d'Ivoire</option><option>Croatia</option><option>Cyprus</option><option>Czech Republic</option><option>Denmark</option><option>Djibouti</option><option>Dominica</option><option>Dominican Republic</option><option>East Timor</option><option>Ecuador</option><option>Egypt</option><option>El Salvador</option><option>England</option><option>Equatorial Guinea</option><option>Eritrea</option><option>Espana</option><option>Estonia</option><option>Ethiopia</option><option>Falkland Islands</option><option>Faroe Islands</option><option>Fiji</option><option>Finland</option><option>France</option><option>French Guiana</option><option>French Polynesia</option><option>French Southern Territories</option><option>Gabon</option><option>Gambia</option><option>Georgia</option><option>Germany</option><option>Ghana</option><option>Gibraltar</option><option>Great Britain</option><option>Greece</option><option>Greenland</option><option>Grenada</option><option>Guadeloupe</option><option>Guam</option><option>Guatemala</option><option>Guinea</option><option>Guinea-Bissau</option><option>Guyana</option><option>Haiti</option><option>Heard and Mc Donald Islands</option><option>Honduras</option><option>Hong Kong</option><option>Hungary</option><option>Iceland</option><option>India</option><option>Indonesia</option><option>Ireland</option><option>Israel</option><option>Italy</option><option>Jamaica</option><option>Japan</option><option>Jordan</option><option>Kazakhstan</option><option>Kenya</option><option>Kiribati</option><option>Korea, Republic of</option><option>Korea (South)</option><option>Kuwait</option><option>Kyrgyzstan</option><option>Lao People's Democratic Republic</option><option>Latvia</option><option>Lebanon</option><option>Lesotho</option><option>Liberia</option><option>Libya</option><option>Liechtenstein</option><option>Lithuania</option><option>Luxembourg</option><option>Macau</option><option>Macedonia</option><option>Madagascar</option><option>Malawi</option><option>Malaysia</option><option>Maldives</option><option>Mali</option><option>Malta</option><option>Marshall Islands</option><option>Martinique</option><option>Mauritania</option><option>Mauritius</option><option>Mayotte</option><option>Mexico</option><option>Micronesia, Federated States of</option><option>Moldova, Republic of</option><option>Monaco</option><option>Mongolia</option><option>Montserrat</option><option>Morocco</option><option>Mozambique</option><option>Myanmar</option><option>Namibia</option><option>Nauru</option><option>Nepal</option><option>Netherlands</option><option>Netherlands Antilles</option><option>New Caledonia</option><option>New Zealand</option><option>Nicaragua</option><option>Niger</option><option>Nigeria</option><option>Niue</option><option>Norfolk Island</option><option>Northern Ireland</option><option>Northern Mariana Islands</option><option>Norway</option><option>Oman</option><option>Pakistan</option><option>Palau</option><option>Panama</option><option>Papua New Guinea</option><option>Paraguay</option><option>Peru</option><option>Philippines</option><option>Pitcairn</option><option>Poland</option><option>Portugal</option><option>Puerto Rico</option><option>Qatar</option><option>Reunion</option><option>Romania</option><option>Russia</option><option>Russian Federation</option><option>Rwanda</option><option>Saint Kitts and Nevis</option><option>Saint Lucia</option><option>Saint Vincent and the Grenadines</option><option>Samoa (Independent)</option><option>San Marino</option><option>Sao Tome and Principe</option><option>Saudi Arabia</option><option>Scotland</option><option>Senegal</option><option>Serbia and Montenegro</option><option>Seychelles</option><option>Sierra Leone</option><option>Singapore</option><option>Slovakia</option><option>Slovenia</option><option>Solomon Islands</option><option>Somalia</option><option>South Africa</option><option>South Georgia and the South Sandwich Islands</option><option>South Korea</option><option>Spain</option><option>Sri Lanka</option><option>St. Helena</option><option>St. Pierre and Miquelon</option><option>Suriname</option><option>Svalbard and Jan Mayen Islands</option><option>Swaziland</option><option>Sweden</option><option>Switzerland</option><option>Taiwan</option><option>Tajikistan</option><option>Tanzania</option><option>Thailand</option><option>Togo</option><option>Tokelau</option><option>Tonga</option><option>Trinidad</option><option>Trinidad and Tobago</option><option>Tunisia</option><option>Turkey</option><option>Turkmenistan</option><option>Turks and Caicos Islands</option><option>Tuvalu</option><option>Uganda</option><option>Ukraine</option><option>United Arab Emirates</option><option>United Kingdom</option><option>United States</option><option>United States Minor Outlying Islands</option><option>Uruguay</option><option>Uzbekistan</option><option>Vanuatu</option><option>Vatican City State (Holy See)</option><option>Venezuela</option><option>Viet Nam</option><option>Virgin Islands (British)</option><option>Virgin Islands (U.S.)</option><option>Wales</option><option>Wallis and Futuna Islands</option><option>Western Sahara</option><option>Yemen</option><option>Zambia</option><option>Zimbabwe</option></select>
        <br /><br />
        Which best describes your vision?<br />
        <input type="radio" name="id_vision" value="0"> My vision is normal. I don't need glasses or contacts.<br />
        <input type="radio" name="id_vision" value="1"> I need glasses or contacts, and I wore them during the experiment. <br />
        <input type="radio" name="id_vision" value="2"> I need glasses or contacts, but I didn't wear them during the experiment.
        <br /><br /><br />
        <button type="button" id="submitButton" align='center' onclick="check_fields('demographics', 'demo_survey')">Continue</button>
        <p id="demo_survey_error_msg" style="color:red; font-weight:bold"></p>
        </fieldset>
        </form>
      </div>
    <div id="prior" style="display: none">
        <form id="prior_survey" name="prior_survey"align='center'><fieldset align='left'>
          Have you performed a similar task before, where you were asked to judge which arm of a cross was longer,
          and something unexpected appeared? If you have, please briefly describe it in the text box.
          Your answer will not affect your compensation for completing this study. <br/><br/>
          <input type="radio" name="id_prior" value="0"> No <br />
          <input type="radio" name="id_prior" value="1"> Yes <br />
          <input type="text" name="id_prior_text" id="id_prior_text" value="" style="width: 600px; height: 40px">
          <br /><br /><br />
          <button type="button" id="submitButton" onclick="check_fields('prior', 'prior_survey')">Continue</button>
          <p id="prior_survey_error_msg" style="color:red; font-weight:bold"></p>
        </fieldset>
        </form>
    </div>
    <div id="instructionScreen">
      <br /> <br /> <br />
      You will be performing a difficult judgment task.
      <br /> <br />
      During this task, keep your eyes focused on the black dot in the center. At some point, a cross will flash briefly somewhere on screen.
      <br /><br />
      Your task will be to judge which arm of the cross ( the top-to-bottom arm or the left-to-right arm ) is longer.
      <br /><br />
      Do the best you can!
      <br /> <br />
      <div id="startButton" class="nextButton">START</div>
    </div>
    <div id="mobileDetected" style="display: none; font-size: 18">
      <br /> <br /> <br />
      We have detected a screen that is too small to run this experiment.
      <br /> <br />
      If you are on a mobile device, please re-load this page on a larger device.
    </div>
    <div id="trialScreen" width=800 height=600>
      <canvas id="crossDisplay" width=800 height=600 style="position:absolute"></canvas>
      <canvas id="fixDisplay" width=800 height=600 style="position:absolute"></canvas>
      <canvas id='bgDisplay' width=800 height=600 style="position:absolute;text-align:center"></canvas>
      <canvas id='maskDisplay' width=800 height=600 style="position:absolute;text-align:center"></canvas>
    </div>
    <div id="fullAttentionInst" align='center' style="display: none">
      <p id="thanks" style="font-family:arial;top:200px">
      <br /> <br /> <br />
      For this next (and final) trial, please <i> ignore the cross </i> and concentrate on the <i> dot in the center. </i> <br /><br />
      </p>
      <div id="contButton" class="nextButton" onclick="store_data('fullAttentionInst')"> CONTINUE </div>
    </div>

    <div id='debrief' align='center' style="display: none">
      <p style="font-family:arial">
      Thank you for participating in our study!
      <br /><br />
      <strong>Purpose of the Study</strong>
      <br /><br />
      In this study, we are replicating a study originally done in the early 90s. In that study, participants completed the same difficult line judgment
      task you did, judging which arm of the cross was longer. On the last trial, a face icon might have appeared in the center of the screen at the same time
      as the cross. About half of people never notice the face icon at all when it did appear; nonetheless, it was found that these people are more likely to notice
      the happy face comparing to other types of faces. This suggests that even when something we see doesn't reach awareness, its meaning
      is still unconsciously processed.
      <br /><br />
      We are interested in how likely you were to notice that a face icon appeared, and if you didn't notice the face icon, whether you were likely to guess one type of faces over the others.
      <br /><br />
      Click the button below to finish the experiment and get your completion code. Thank you again for participating!
      </p>
      <form id="data_form" name="data_form" action="face_study1_data.php" method="post" style='position:relative'><fieldset>
      <img src="face_study_mask.png" id="maskimg" hidden>
      <input type="hidden" name="studyName" value="">
      <input type="hidden" name="worker_id" value="" />
      <input type="hidden" name="start" value="">
      <input type="hidden" name="end" value="">
      <input type="hidden" name="browser" value="">
      <input type="hidden" name="line_judgment0" value="" />
      <input type="hidden" name="line_judgment_answer0" value="" />
      <input type="hidden" name="line_judgment_correct0" value="" />
      <input type="hidden" name="line_judgment1" value="" />
      <input type="hidden" name="line_judgment_answer1" value="" />
      <input type="hidden" name="line_judgment_correct1" value="" />
      <input type="hidden" name="line_judgment2" value="" />
      <input type="hidden" name="line_judgment_answer2" value="" />
      <input type="hidden" name="line_judgment_correct2" value="" />
      <input type="hidden" name="line_judgment3" value="" />
      <input type="hidden" name="line_judgment_answer3" value="" />
      <input type="hidden" name="line_judgment_correct3" value="" />
      <input type="hidden" name="line_judgment4" value="" />
      <input type="hidden" name="line_judgment_answer4" value="" />
      <input type="hidden" name="line_judgment_correct4" value="" />
      <input type="hidden" name="face_type" value="" />
      <input type="hidden" name="face_notice" value="" />
      <input type="hidden" name="id_face_survey_yes" value="" />
      <input type="hidden" name="face_question" value="" />
      <input type="hidden" name="square_notice1" value="" />
      <input type="hidden" name="id_face_survey_yes1" value="" />
      <input type="hidden" name="face_question1" value="" />
      <input type="hidden" name="playback_pre" value="" />
      <input type="hidden" name="playback" value="" />
      <input type="hidden" name="id_age" value="" />
      <input type="hidden" name="country" value="" />
      <input type="hidden" name="id_vision" value="" />
      <input type="hidden" name="prior" value="" />
      <input type="hidden" name="prior_text" value="" />
      <input type="hidden" name="duration" value="" />
      <input type="hidden" name="displayDur" value="" />
      <input type="hidden" name="maskDur" value="" />
      <input type="hidden" name="cross_loc0" value="" />
      <input type="hidden" name="cross_loc1" value="" />
      <input type="hidden" name="cross_loc2" value="" />
      <input type="hidden" name="cross_loc3" value="" />
      <input type="hidden" name="cross_loc4" value="" />
      <input type="hidden" name="horizontal_length0" value="" />
      <input type="hidden" name="vertical_length0" value="" />
      <input type="hidden" name="horizontal_length1" value="" />
      <input type="hidden" name="vertical_length1" value="" />
      <input type="hidden" name="horizontal_length2" value="" />
      <input type="hidden" name="vertical_length2" value="" />
      <input type="hidden" name="horizontal_length3" value="" />
      <input type="hidden" name="vertical_length3" value="" />
      <input type="hidden" name="horizontal_length4" value="" />
      <input type="hidden" name="vertical_length4" value="" />
      <input type="hidden" name="cross_dist" value="" />
      <input type="hidden" name="IB_dist" value="" />
      <input type="hidden" name="faces_option_order" value="" />
      <input type="hidden" name="faces_option_order1" value="" />
      <input type="hidden" name="empty" value="" />
      <input type="submit" id="submit" value='Get Code'>
    </fieldset>
    </form>
    </div>

    <style class="faces_style">
      .face {
        display: inline-block;
      }
    </style>

    <div class="svg_images" hidden>

      <div class="face happy_face">
        <svg height="100" width="100">
          <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
          <svg height="100" width="100" x="30" y="25">
          <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <svg height="100" width="100" x="50" y="25">
          <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <svg height="70" width="100" x="10" y="55">
            <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
          </svg>
        </svg>
      </div>

      <div class="face sad_face">
        <svg height="100" width="100">
          <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
          <svg height="100" width="100" x="30" y="25">
          <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <svg height="100" width="100" x="50" y="25">
          <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <svg height="70" width="100" y="4">
            <ellipse cx="51" cy="75" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
          </svg>
        </svg>
      </div>

      <div class="face neutral_face">
        <svg height="100" width="100">
          <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
          <svg height="100" width="100" x="30" y="25">
          <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <svg height="100" width="100" x="50" y="25">
          <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <rect x="31" y="65" width="40" height="1" stroke-width="3" stroke="black"></rect>
        </svg>
      </div>

      <div class="face inverted_face">
        <svg height="100" width="100" style="transform: rotate(180deg)">
          <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
          <svg height="100" width="100" x="30" y="25">
          <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <svg height="100" width="100" x="50" y="25">
          <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <svg height="70" width="100" x="10" y="55">
            <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
          </svg>
        </svg>
      </div>

      <div class="face scrambled_face">
        <svg height="100" width="100" style="transform: rotate(90deg)">
          <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
          <svg height="100" width="100" x="30" y="20">
            <ellipse cx="10" cy="10" rx="5" ry="10" />
          </svg>
          <svg height="100" width="100" x="55" y="60">
            <ellipse cx="10" cy="10" rx="10" ry="5" />
          </svg>
          <svg height="70" width="100" x="10" y="40">
            <ellipse cx="40" cy="0" rx="25" ry="20" stroke="black" stroke-width="3" fill="none"/>
          </svg>
        </svg>
      </div>

      <div class="face circle">
        <svg height="100" width="100">
          <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="transparent"></circle>
        </svg>
      </div>

    </div>

    <script>
    //global parameters documentation
    document.data_form.studyName.value = "face_study1";
    Day = formatDate(new Date());
    document.data_form.start.value = Day;
    TimeStart = new Date();
    //Randomize IB type
    var faces = [
      'happy_face',
      'sad_face',
      'neutral_face',
      'inverted_face',
      'scrambled_face'
    ]
    var face = shuffle(faces)[0]
    document.data_form.face_type.value = face;
    console.log(face);
    //Check browser type
    checkBrowser();
    document.data_form.browser.value = browserType;
    function checkBrowser() {
        if((navigator.userAgent.indexOf("Opera") || navigator.userAgent.indexOf('OPR')) != -1 ) {
            browserType = "Opera";
            return 'Opera'
        }
        else if(navigator.userAgent.indexOf("Edg") != -1 ) {
            browserType = "Edge";
            return 'Edge'
        }
        else if(navigator.userAgent.indexOf("Chrome") != -1 ) {
            browserType = "Chrome";
            return 'Chrome'
        }
        else if(navigator.userAgent.indexOf("Safari") != -1) {
            browserType = "Safari";
            return 'Safari'
        }
        else if(navigator.userAgent.indexOf("Firefox") != -1 ) {
            browserType = "Firefox";
            return 'Firefox'
        }
        else if((navigator.userAgent.indexOf("MSIE") != -1 ) || (!!document.documentMode == true )) {
            browserType = "IE";
            return 'IE'
        }
        else {
            browserType = "unknown";
            return 'unknown'
        }
    }

    function run() {

      function Trial() {
          this.init = function() {
            this.trialOver = false;
            this.trialScreen = document.getElementById("trialScreen");
            if (trialsCompleted == 0) {
              this.instructionScreen = document.getElementById("instructionScreen");
            }
            fixCanvas = document.getElementById("fixDisplay");
            crossCanvas = document.getElementById("crossDisplay");
            maskCanvas = document.getElementById("maskDisplay");
            bgCanvas = document.getElementById("bgDisplay");
            return true;
          }

          this.start = function() {
            cross_loc = Math.floor(Math.random()*4);

            if (trialsCompleted == 0) {
              this.instructionScreen.style.display = "none";
            }
            this.trialScreen.style.display = "block";
            this.fixDur = 1500;
            //document.data_form.fixDur.value = this.fixDur;
            this.displayDur = 200;
            document.data_form.displayDur.value = this.displayDur;
            this.maskDur = 500;
            document.data_form.maskDur.value = this.maskDur;

            drawFixation();
            drawBorder();
            setTimeout(clearDisplay, this.fixDur + this.displayDur + this.maskDur, bgCanvas);
            if (trialParams[trialsCompleted] == 'cross') {
              setTimeout(clearDisplay, this.fixDur, fixCanvas);
              setTimeout(drawCross, this.fixDur, cross_loc);
              setTimeout(clearDisplay, this.fixDur + this.displayDur, crossCanvas);
              setTimeout(drawMask, this.fixDur + this.displayDur);
            }
            else if (trialParams[trialsCompleted] == 'ib') {
              setTimeout(clearDisplay, this.fixDur, fixCanvas);
              setTimeout(drawSquare, this.fixDur, cross_loc);
              setTimeout(clearDisplay, this.fixDur + this.displayDur, crossCanvas);
              setTimeout(drawMask, this.fixDur + this.displayDur);
            }
            setTimeout(clearDisplay, this.fixDur + this.displayDur, crossCanvas);
            setTimeout(clearDisplay, this.fixDur + this.displayDur, fixCanvas);
            setTimeout(clearDisplay, this.fixDur + this.displayDur + this.maskDur, maskCanvas);
            setTimeout(this.end, this.fixDur + this.displayDur + this.maskDur);
          }
          this.end = function() {
            if (trialsCompleted < 4) {
              document.getElementById("trialScreen").style.display = 'none';
              document.getElementById("line_judgment").style.display = 'block';
              document.getElementById("line_judgment").style.visibility = 'visible';
           } else if (trialsCompleted == 4) {
              document.getElementById("trialScreen").style.display = 'none';
              document.getElementById("line_judgment").style.display = 'block';
              document.getElementById("line_judgment").style.visibility = 'visible';
           }
        }
      } //end of trial class

      //////// PRIMARY FUNCTIONS ////////

    function init() {
      trial = new Trial;
      if (trial.init()) {
          if (trialsCompleted == 0) {
            trial.instructionScreen.style.display = "block";
            document.getElementById("startButton").onclick = function() {trial.start()};
          } else {
            trial.start();
          }
      }
    }

    init();

  } //end of function run()

  function getRandomList(n, min, max) {
    for (var a=[],i=0;i<max;++i) a[i]=i;
    // http://stackoverflow.com/questions/962802#962890
    function shuffle(array) {
      var tmp, current, top = array.length;
      if(top) while(--top) {
        current = Math.floor(Math.random() * (top + 1));
        tmp = array[current];
        array[current] = array[top];
        array[top] = tmp;
      }
      return array;
    }

    return shuffle(a).slice(0, n);
  }

  /**
   * Randomize array element order in-place.
   * Using Durstenfeld shuffle algorithm.
   */
  function shuffle(array) {
      for (var i = array.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var temp = array[i];
          array[i] = array[j];
          array[j] = temp;
      }
      return array;
  }

  function getRadioValue(name) {
      var group = document.getElementsByName(name);
      for (var i=0;i<group.length;i++) {
          if (group[i].checked) {
              return group[i].value;
          }
      }
      return '';
  }

  function padTo2Digits(num) {
          return num.toString().padStart(2, '0');
        }
  function formatDate(date) {
      return (
          [
              date.getUTCFullYear(),
              padTo2Digits(date.getUTCMonth() + 1),
              padTo2Digits(date.getUTCDate()),
            ].join('/') +
            ' ' +
            [
              padTo2Digits(date.getUTCHours()),
              padTo2Digits(date.getUTCMinutes()),
              padTo2Digits(date.getUTCSeconds()),
            ].join(':')
          );
        }

  function check_fields(div_id, form_name) {
      var error_count = 0;
      var form = document.getElementById(form_name);
      for (i=0; i<form.elements.length; i++) {
        if (((form.elements[i].value == "") ||
            (form.elements[i].value == null)) &&
            ((form.elements[i].type != "button") &&
            (form.elements[i].type != "fieldset") &&
            (form.elements[i].type != undefined) &&
            (form.elements[i].type != "text") &&
            (form.elements[i].type != "hidden"))) {
            error_count++;
        }
        if (form.elements[i].type == "radio") {
            var radioChecked = false;
            var radios = document.getElementsByName(form.elements[i].name);
            for (r=0; r<radios.length; r++) {
                if (radios[r].checked) {
                    radioChecked = true;
                }
            }
            if (!radioChecked) {
                error_count++;
            }
        }
        if (form.elements[i].type == 'text' & div_id != 'prior') {
          if (form.elements[i].value.length < 3) {
            error_count++;
          }
        }
        if (form.elements[i].value == "NA") {
            error_count++;
        }
      }
      if (error_count >= 1) {
          document.getElementById(form_name+"_error_msg").innerHTML = "One or" +
          " more questions are unanswered. Please answer these" +
          " questions and then click continue.";
      } else {
          document.getElementById(form_name+"_error_msg").innerHTML = "";
          store_data(div_id);
      }
    }

    function face_fn() {
      var face_elements = document.querySelectorAll('span[face-type]')
      var faces_shuffled = shuffle(Array.from(face_elements))

      var faces_break_start = document.querySelector('.faces_break_start')
      var faces_break_mid = document.querySelector('.faces_break_mid')

        var faces_order_object = {}

      for (let i = 0; i < 6; i++) {
          let face = faces_shuffled[i]
          faces_order_object[{
              0:2, 1:1, 2:0, 3:5, 4:4, 5:3
          }[i]] = face.getAttribute('face-type')
          if (i < 3) {
              faces_break_start.after(face)
          } else {
              faces_break_mid.after(face)
          }
      }
      var faces_order_array = Object.values(faces_order_object);
      faces_order_array.splice(0, 0, "R1:");
      faces_order_array.splice(4, 0, " R2:");
      faces_order_array = JSON.stringify(faces_order_array);
      //faces_order_array = faces_order_array.toString();
      //faces_order_array.join("_");
      document.data_form.faces_option_order.value = faces_order_array;
      console.log(document.data_form.faces_option_order.value);
    }

    function face_fn1() {
      var face_elements = document.querySelectorAll('span[face-type1]')
      console.log(face_elements);
      var faces_shuffled = shuffle(Array.from(face_elements))

      var faces_break_start1 = document.querySelector('.faces_break_start1')
      var faces_break_mid1 = document.querySelector('.faces_break_mid1')

        var faces_order_object = {}

      for (let i = 0; i < 6; i++) {
          let face = faces_shuffled[i]
          faces_order_object[{
              0:2, 1:1, 2:0, 3:5, 4:4, 5:3
          }[i]] = face.getAttribute('face-type1')
          if (i < 3) {
              faces_break_start1.after(face)
          } else {
              faces_break_mid1.after(face)
          }
      }
      var faces_order_array1 = Object.values(faces_order_object);
      faces_order_array1.splice(0, 0, "R1:");
      faces_order_array1.splice(4, 0, " R2:");
      faces_order_array1 = JSON.stringify(faces_order_array1);
      //faces_order_array1 = faces_order_array1.toString();
      document.data_form.faces_option_order1.value = faces_order_array1;
      console.log(document.data_form.faces_option_order1.value);
    }

    function store_data(div_id){
      if (div_id == 'line_judgment') {
        var options = document.getElementsByName("line_judgment_ans");
        for (var i=0;i<options.length;i++) { //TODO use this to capture responses and clear them at the same time
          if (options[i].checked) {
            document.data_form['line_judgment' + trialsCompleted + ''].value = options[i].value;
            document.data_form['line_judgment_answer' + trialsCompleted + ''].value = last_line_longer;
            document.data_form['line_judgment_correct' + trialsCompleted + ''].value = options[i].value == last_line_longer ? 1 : 0;
          }
          options[i].checked = false;
        }
        document.getElementById("line_judgment").style.display = 'none';
        document.getElementById("line_judgment").style.visibility = 'hidden';
        trialsCompleted += 1;
        if (trialsCompleted < 4) {
          run();
        } else if (trialsCompleted == 4) {
          document.getElementById("face_notice").style.display = 'block';
        } else {
          document.getElementById("square_notice1").style.display = 'block';
        }
      } else if (div_id == 'face_notice') {
          document.data_form.face_notice.value = getRadioValue('face_notice');
          document.getElementById("face_notice").style.display = 'none';
          if (document.data_form.face_notice.value == 'Yes') {
              document.getElementById("face_question_yes").style.display = 'block';
          } else if (document.data_form.face_notice.value == 'No') {
              face_fn();
              document.getElementById("face_question").style.display = 'block';
          }
      } else if (div_id == 'face_question_yes') {
          document.data_form.id_face_survey_yes.value = document.getElementById("id_face_survey_yes").value;
          document.getElementById("face_question_yes").style.display = 'none';
          face_fn();
          document.getElementById("face_question").style.display = 'block';
      } else if (div_id == 'face_question')  {
          document.data_form.face_question.value = getRadioValue('face_question');
          document.getElementById("face_question").style.display = 'none';
          document.getElementById("fullAttentionInst").style.display = 'block';
      } else if (div_id == 'fullAttentionInst') {
          document.getElementById("fullAttentionInst").style.display = 'none';
          run();
      } else if (div_id == 'square_notice1') {
          document.data_form.square_notice1.value = getRadioValue('square_notice1');
          document.getElementById("square_notice1").style.display = 'none';
          if (document.data_form.square_notice1.value == 'Yes') {
              document.getElementById("face_question_yes1").style.display = 'block';
          } else if (document.data_form.square_notice1.value == 'No') {
              face_fn1();
              document.getElementById("face_question1").style.display = 'block';
          }
      } else if (div_id == 'face_question_yes1') {
          document.data_form.id_face_survey_yes1.value = document.getElementById("id_face_survey_yes1").value;
          document.getElementById("face_question_yes1").style.display = 'none';
          face_fn1();
          document.getElementById("face_question1").style.display = 'block';
      } else if (div_id == 'face_question1') {
          document.data_form.face_question1.value = getRadioValue('face_question1');
          document.getElementById("face_question1").style.display = 'none';
          document.getElementById("playback_pre").style.display = 'block';
      } else if (div_id == 'playback_pre') {
          document.data_form.playback_pre.value = getRadioValue('playback_pre');
          document.getElementById("playback_pre").style.display = 'none';
          if (document.data_form.playback_pre.value == 'No') {
              document.getElementById("playback").style.display = 'block';
          } else if (document.data_form.playback_pre.value == 'Yes') {
              document.getElementById("demographics").style.display = 'block';
          }
      } else if (div_id == 'playback') {
         document.data_form.playback.value = document.getElementById("id_playback").value;
         document.getElementById("playback").style.display = 'none';
         document.getElementById("demographics").style.display = 'block';
      } else if (div_id == 'demographics') {
        document.data_form.id_age.value = getRadioValue('id_age');
        document.data_form.country.value = document.getElementById("country_options").value;
        document.data_form.id_vision = getRadioValue('id_vision');
        document.getElementById('demographics').style.display = 'none';
        document.getElementById("prior").style.display = 'block';
      } else if (div_id == 'prior') {
        document.data_form.prior.value = getRadioValue('id_prior');
        document.data_form.prior_text.value = document.getElementById("id_prior_text").value;
        document.getElementById('prior').style.display = 'none';
        document.getElementById('debrief').style.display = 'block';
        //Record end time and calculate experiment duration
        DayEnd = formatDate(new Date());
        document.data_form.end.value = DayEnd;
        TimeEnd = new Date();
        duration = Math.round((TimeEnd.getTime() - TimeStart.getTime())/1000);
        document.data_form.duration.value = duration;
      }
    }


    function drawInlineSVG(svgElement, ctx, x1, y1) {
      var svgURL = new XMLSerializer().serializeToString(svgElement);
      var img = new Image();
      img.src = 'data:image/svg+xml; charset=utf8, ' + encodeURIComponent(svgURL);
      img.onload = function() {
        ctx.drawImage(this, x1, y1, 40, 40);
      }
    }


    function drawSquare(location) {

      var display = document.getElementById("crossDisplay");
      var context = display.getContext("2d");
      var thickness = 2;
      var lengths = [2.7*scale, 3.3*scale, 3.9*scale, 4.5*scale];
      var width = lengths[Math. floor(Math.random()*4)];
      lengths.splice(lengths.indexOf(width), 1);
      var height = lengths[Math. floor(Math.random()*3)];
      document.data_form['horizontal_length' + trialsCompleted + ''].value = width;
      document.data_form['vertical_length' + trialsCompleted + ''].value = height;
      var offset = width - height;
      last_line_longer = width > height ? 'horiz' : 'vert';
      var cross_dist = 2*scale;
      document.data_form.IB_dist.value = 0;
      var allpos = [[.5*display.width - cross_dist, .5*display.height - cross_dist], [.5*display.width + cross_dist, .5*display.height - cross_dist],
                    [.5*display.width + cross_dist, .5*display.height + cross_dist], [.5*display.width - cross_dist, .5*display.height + cross_dist]]; //4 peripheral coordinates
      var pos = allpos[location];
      var x = pos[0];
      var y = pos[1];
      if (cross_loc == 0) {
          document.data_form['cross_loc' + trialsCompleted + ''].value = 'UL ' + [x,y];
      } else if (cross_loc == 1) {
          document.data_form['cross_loc' + trialsCompleted + ''].value = 'UR ' + [x,y];
      } else if (cross_loc == 2) {
          document.data_form['cross_loc' + trialsCompleted + ''].value = 'LR ' + [x,y];
      } else if (cross_loc == 3) {
          document.data_form['cross_loc' + trialsCompleted + ''].value = 'LL ' + [x,y];
      }
      console.log(document.data_form['cross_loc' + trialsCompleted + ''].value);
      var [x1, y1] = [.5*display.width - 20, .5*display.height - 20];

      /////////////////
      var svgElement = document.querySelector(`.${face} svg`)
      drawInlineSVG(svgElement, context, x1, y1)
      /////////////////

      context.save();
      context.lineWidth = thickness;
      context.beginPath();
      context.moveTo(x - (.5*width), y);
      context.lineTo(x + (.5*width), y);
      context.stroke();
      context.beginPath();
      context.moveTo(x, y - (.5*height));
      context.lineTo(x, y + (.5*height));
      context.stroke();
      context.restore();
    }

    function drawCross(location) {

      var display = document.getElementById("crossDisplay");
      var context = display.getContext("2d");
      var thickness = 2;
      var lengths = [2.7*scale, 3.3*scale, 3.9*scale, 4.5*scale];
      var width = lengths[Math. floor(Math.random()*4)];
      lengths.splice(lengths.indexOf(width), 1);
      var height = lengths[Math. floor(Math.random()*3)];
      document.data_form['horizontal_length' + trialsCompleted + ''].value = width;
      document.data_form['vertical_length' + trialsCompleted + ''].value = height;
      var offset = width - height;
      last_line_longer = width > height ? 'horiz' : 'vert';
      var cross_dist = 2*scale; // horizontal/vertical distance to the center of display
      document.data_form.cross_dist.value = cross_dist;
      var allpos = [[.5*display.width - cross_dist, .5*display.height - cross_dist], [.5*display.width + cross_dist, .5*display.height - cross_dist],
                    [.5*display.width + cross_dist, .5*display.height + cross_dist], [.5*display.width - cross_dist, .5*display.height + cross_dist]]; //4 peripheral coordinates
      var pos = allpos[location];
      //var rnd_pos = pos[Math. floor(Math.random())]
      var x = pos[0];
      var y = pos[1];
      if (cross_loc == 0) {
          document.data_form['cross_loc' + trialsCompleted + ''].value = 'UL ' + [x,y];
      } else if (cross_loc == 1) {
          document.data_form['cross_loc' + trialsCompleted + ''].value = 'UR ' + [x,y];
      } else if (cross_loc == 2) {
          document.data_form['cross_loc' + trialsCompleted + ''].value = 'LR ' + [x,y];
      } else if (cross_loc == 3) {
          document.data_form['cross_loc' + trialsCompleted + ''].value = 'LL ' + [x,y];
      }
      console.log(document.data_form['cross_loc' + trialsCompleted + ''].value);
      context.save();
      context.lineWidth = thickness;
      context.beginPath();
      context.moveTo(x - (.5*width), y);
      context.lineTo(x + (.5*width), y);
      context.stroke();
      context.beginPath();
      context.moveTo(x, y - (.5*height));
      context.lineTo(x, y + (.5*height));
      context.stroke();
      context.restore();
    } //end of lines class

    function drawFixation() {
      var display = document.getElementById("fixDisplay");
      var context = display.getContext("2d");
      var radius = 5;
      var x = .5*display.width;//half the canvas width
      var y = .5*display.height;
      context.save();
      context.fillStyle = 'black';
      context.beginPath();
      context.arc(x, y, radius, 0, (Math.PI*2), true);
      context.closePath();
      context.fill();
      context.restore();
    }; //end of fixation

    function drawMask() {
      var display = document.getElementById("maskDisplay");
      var context = display.getContext("2d");
      var radius = 5*scale;
      var x = .5*display.width;//half the canvas width
      var y = .5*display.height;
      context.save();
      var pattern = context.createPattern(maskimg, "repeat");
      context.fillStyle = pattern;
      context.beginPath();
      context.arc(x, y, radius, 0, (Math.PI*2), true);
      context.closePath();
      context.fill();
      context.restore();
    }

    function drawBorder() {
      var display = document.getElementById("bgDisplay");
      var context = display.getContext("2d");
      var radius = 5*scale;
      var x = .5*display.width;//half the canvas width
      var y = .5*display.height;
      var thickness = 3;
      context.save();
      context.strokeStyle = 'black';
      context.lineWidth = thickness;
      context.beginPath();
      context.arc(x, y, radius, 0, (Math.PI*2), true);
      context.closePath();
      context.stroke();
      context.restore();
    }

    function clearDisplay(canvas) {
      var context = canvas.getContext("2d");
      context.clearRect(0, 0, canvas.width, canvas.height);
    };

    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
          var pair = vars[i].split("=");
          if(pair[0] == variable) {
              return pair[1];
          }
      }
      return(false);
    }

    function get_condition(callback) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                res = xmlhttp.responseText;
                callback(res);
            }
        };
        xmlhttp.open("GET", "face_study1_condition.php?workerId="+getQueryVariable('workerID'), true);
        xmlhttp.send();
    }

      function assign_condition(response) {
        vals = response.split(",");
        response = parseInt(vals[0]) % 6;
        workerID = vals[1];
        //response = parseInt(response) % 7;
        //workerID = getQueryVariable('workerID');
        document.data_form.worker_id.value = workerID;
        console.log(document.data_form.worker_id.value);
        //cross_loc = Math.floor(Math.random()*4); //TODO peripheral position of cross may be fixed, not random on each trial; if so, set here
      }

  function main() {
    setTimeout(function(){
        if ((screen.width < 480) || (screen.height < 480)) {
          var mobile = document.getElementById("mobileDetected");
          mobile.style.display = "block";
        } else {
          get_condition(assign_condition); //assign_condition()
          trialParams = ['cross', 'cross', 'cross', 'ib', 'ib'];
          trialsCompleted = 0;
          scale = 50; //pixels per degree; adjust here to adjust everywhere
          run();
              }
    }, 100);
  }

  main();

  </script>
  </body>
</html>
